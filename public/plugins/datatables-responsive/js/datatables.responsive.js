'use strict';function ResponsiveDatatablesHelper(tableSelector,breakpoints){if(typeof tableSelector==='string'){this.tableElement=$(tableSelector);}else{this.tableElement=tableSelector;}
this.columnIndexes=[];this.columnsShownIndexes=[];this.columnsHiddenIndexes=[];this.expandColumn=undefined;this.breakpoints={};this.expandIconTemplate='<span class="responsiveExpander"></span>';this.rowTemplate='<tr class="row-detail"><td><ul><!--column item--></ul></td></tr>';this.rowLiTemplate='<li><span class="columnTitle"><!--column title--></span>: <!--column value--></li>';this.disabled=false;this.skipNextWindowsWidthChange=false;this.init(breakpoints);}
ResponsiveDatatablesHelper.prototype.init=function(breakpoints){var breakpointsSorted=[];_.each(breakpoints,function(value,key){breakpointsSorted.push({name:key,upperLimit:value,columnsToHide:[]});});breakpointsSorted=_.sortBy(breakpointsSorted,'upperLimit');var lowerLimit=undefined;_.each(breakpointsSorted,function(value){value.lowerLimit=lowerLimit;lowerLimit=value.upperLimit;});breakpointsSorted.push({name:'default',lowerLimit:lowerLimit,upperLimit:undefined,columnsToHide:[]});for(var i=0;i<breakpointsSorted.length;i++){this.breakpoints[breakpointsSorted[i].name]=breakpointsSorted[i];}
var columns=this.tableElement.fnSettings().aoColumns;for(var i=0;i<columns.length;i++){if(columns[i].bVisible){this.columnIndexes.push(i)}}
var headerElements=$('thead th',this.tableElement);_.each(headerElements,function(element,index){if($(element).attr('data-class')==='expand'){this.expandColumn=index;}
var dataHide=$(element).attr('data-hide');if(dataHide!==undefined){var splitBreakingPoints=dataHide.split(/,\s*/);_.each(splitBreakingPoints,function(e){if(this.breakpoints[e]!==undefined){this.breakpoints[e].columnsToHide.push(this.columnIndexes[index]);}},this);}},this);var that=this;$(window).bind("resize",function(){that.respond();});};ResponsiveDatatablesHelper.prototype.respond=function(){if(this.disabled){return;}
var newWindowWidth=$(window).width();var updatedHiddenColumnsCount=0;var newColumnsToHide=[];_.each(this.breakpoints,function(element){if((!element.lowerLimit||newWindowWidth>element.lowerLimit)&&(!element.upperLimit||newWindowWidth<=element.upperLimit)){newColumnsToHide=element.columnsToHide;}},this);var columnShowHide=false;if(!this.skipNextWindowsWidthChange){if(this.columnsHiddenIndexes.length!==newColumnsToHide.length){columnShowHide=true;}else{var d1=_.difference(this.columnsHiddenIndexes,newColumnsToHide).length;var d2=_.difference(newColumnsToHide,this.columnsHiddenIndexes).length;columnShowHide=d1+ d2>0;}}
if(columnShowHide){this.skipNextWindowsWidthChange=true;this.columnsHiddenIndexes=newColumnsToHide;this.columnsShownIndexes=_.difference(this.columnIndexes,this.columnsHiddenIndexes);this.showHideColumns();updatedHiddenColumnsCount=this.columnsHiddenIndexes.length;this.skipNextWindowsWidthChange=false;}
if(this.columnsHiddenIndexes.length){this.tableElement.addClass('has-columns-hidden');var that=this;$('tr.detail-show',this.tableElement).each(function(index,element){var tr=$(element);if(tr.next('.row-detail').length===0){ResponsiveDatatablesHelper.prototype.showRowDetail(that,tr);}});}else{this.tableElement.removeClass('has-columns-hidden');$('tr.row-detail').remove();}};ResponsiveDatatablesHelper.prototype.showHideColumns=function(){for(var i=0,l=this.columnsShownIndexes.length;i<l;i++){this.tableElement.fnSetColumnVis(this.columnsShownIndexes[i],true,false);}
for(var i=0,l=this.columnsHiddenIndexes.length;i<l;i++){this.tableElement.fnSetColumnVis(this.columnsHiddenIndexes[i],false,false);}
var that=this;$('tr.row-detail').remove();if(this.tableElement.hasClass('has-columns-hidden')){$('tr.detail-show',this.tableElement).each(function(index,element){ResponsiveDatatablesHelper.prototype.showRowDetail(that,$(element));});}};ResponsiveDatatablesHelper.prototype.createExpandIcon=function(tr){if(this.disabled){return;}
var tds=$('td',tr);if(this.expandColumn!==undefined&&this.expandColumn<tds.length){var td=$(tds[this.expandColumn]);if($('span.responsiveExpander',td).length==0){td.prepend(this.expandIconTemplate);td.on('click','span.responsiveExpander',{responsiveDatatablesHelperInstance:this},this.showRowDetailEventHandler);}}};ResponsiveDatatablesHelper.prototype.showRowDetailEventHandler=function(event){if(this.disabled){return;}
var tr=$(this).closest('tr');if(tr.hasClass('detail-show')){ResponsiveDatatablesHelper.prototype.hideRowDetail(event.data.responsiveDatatablesHelperInstance,tr);}else{ResponsiveDatatablesHelper.prototype.showRowDetail(event.data.responsiveDatatablesHelperInstance,tr);}
tr.toggleClass('detail-show');event.stopPropagation();};ResponsiveDatatablesHelper.prototype.showRowDetail=function(responsiveDatatablesHelperInstance,tr){var tableContainer=responsiveDatatablesHelperInstance.tableElement;var columns=tableContainer.fnSettings().aoColumns;var newTr=$(responsiveDatatablesHelperInstance.rowTemplate);var ul=$('ul',newTr);_.each(responsiveDatatablesHelperInstance.columnsHiddenIndexes,function(index){var li=$(responsiveDatatablesHelperInstance.rowLiTemplate);$('.columnTitle',li).html(columns[index].sTitle);li.append(tableContainer.fnGetData(tr[0],index));ul.append(li);});var colspan=responsiveDatatablesHelperInstance.columnIndexes.length- responsiveDatatablesHelperInstance.columnsHiddenIndexes.length;$('td',newTr).attr('colspan',colspan);tr.after(newTr);};ResponsiveDatatablesHelper.prototype.hideRowDetail=function(responsiveDatatablesHelperInstance,tr){tr.next('.row-detail').remove();};ResponsiveDatatablesHelper.prototype.disable=function(disable){this.disabled=(disable===undefined)||true;if(this.disabled){$('tbody tr.row-detail',this.tableElement).remove();$('tbody tr',this.tableElement).removeClass('detail-show');$('tbody tr span.responsiveExpander',this.tableElement).remove();this.columnsHiddenIndexes=[];this.columnsShownIndexes=this.columnIndexes;this.showHideColumns();this.tableElement.removeClass('has-columns-hidden');this.tableElement.off('click','span.responsiveExpander',this.showRowDetailEventHandler);}}